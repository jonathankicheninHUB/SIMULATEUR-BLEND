<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DoV Manager v3.22 (Real Prices)</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #475569; }
        .animate-fade-in { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        .progress-bar { transition: width 0.5s ease-in-out; }
    </style>
</head>
<body class="bg-slate-900 text-slate-100 min-h-screen">

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- ICONS ---
        const Shield = ({size=20}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>;
        const FactoryIcon = ({size=20}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M2 20a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8l-7 5V8l-7 5V4a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z"/><path d="M17 18h1"/><path d="M12 18h1"/><path d="M7 18h1"/></svg>;
        const Crosshair = ({size=20}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><line x1="22" y1="12" x2="18" y2="12"/><line x1="6" y1="12" x2="2" y2="12"/><line x1="12" y1="6" x2="12" y2="2"/><line x1="12" y1="22" x2="12" y2="18"/></svg>;
        const CheckCircle = ({size=20}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>;
        const Package = ({size=20}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m16.5 9.4-9-5.19"/><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/><polyline points="3.27 6.96 12 12.01 20.73 6.96"/><line x1="12" y1="22.08" x2="12" y2="12"/></svg>;
        const Zap = ({size=20}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>;
        const Briefcase = ({size=20}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="2" y="7" width="20" height="14" rx="2" ry="2"/><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/></svg>;
        const Database = ({size=20}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/></svg>;
        const FlaskConical = ({size=20}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M10 2v7.527a2 2 0 0 1-.211.896L4.72 20.55a1 1 0 0 0 .9 1.45h12.76a1 1 0 0 0 .9-1.45l-5.069-10.127A2 2 0 0 1 14 9.527V2"/><line x1="8.5" x2="15.5" y1="2" y2="2"/><path d="M8.5 2h7"/><path d="M9 22h6"/></svg>;
        const Clock = ({size=20}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>;
        const TrendingUp = ({size=20}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>;
        const KeyIcon = ({size=20}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m21 2-2 2m-7.6 7.6a6.5 6.5 0 1 1-5.3 5.3L3 21l3-3 2.1-2.1a2 2 0 0 1 2.8 0L13.4 13.4a2 2 0 0 1 0 2.8l-4.3 4.3"/><path d="m10 10 1.5 1.5"/><path d="m14 6 1.5 1.5"/><path d="m18 2 1.5 1.5"/></svg>;
        const Lock = ({size=20}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>;
        const Compass = ({size=20}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><polygon points="16.24 7.76 14.12 14.12 7.76 16.24 9.88 9.88 16.24 7.76"/></svg>;
        const RefreshCw = ({size=20}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 2v6h-6"/><path d="M3 12a9 9 0 0 1 15-6.7L21 8"/><path d="M3 22v-6h6"/><path d="M21 12a9 9 0 0 1-15 6.7L3 16"/></svg>;

        // ** CORRECTED DEFAULT PRICES **
        const INITIAL_MARKET_PRICES = { WAX: 1, DOVX: 0.00528552, DOVR: 0.00045262, DOVH: 0.00045262, DOVF: 0.00045262, DOVS: 0.00045262 };
        const Card = ({ children, className = "" }) => <div className={`bg-slate-800 border border-slate-700 rounded-lg p-4 shadow-xl ${className}`}>{children}</div>;

        // --- BLEND SIMULATOR (V3.22 REAL PRICES) ---
        const BlendSimulator = ({ marketPrices, waxPriceUsd }) => {
            const [activeZone, setActiveZone] = useState('CITY_1'); 
            const [targetType, setTargetType] = useState('ALL_4'); 
            
            const [inventory, setInventory] = useState({ 
                FUEL: 0, REPAIR: 0, SUPPLY: 0, HEALTH: 0, 
                F4_FUEL: 0, F4_REPAIR: 0, F4_SUPPLY: 0, F4_HEALTH: 0,
                KEY_CITY: 0, KEY_BEACH: 0, KEY_FOREST: 0 
            });
            const [simStats, setSimStats] = useState({ runs: 0, completed: false });
            
            // CONFIG PRICES
            const [keyPrices, setKeyPrices] = useState({ CITY: 50, BEACH: 5, FOREST: 10 });
            const [sellMode, setSellMode] = useState('UNIT'); 
            const [f1Price, setF1Price] = useState(5);
            const [f4Price, setF4Price] = useState(250);
            const [numAccounts, setNumAccounts] = useState(1);
            
            // TU PRICE - Updated default
            const [tuPrice, setTuPrice] = useState(0.00045262); 

            // ZONE DATA
            const ZONE_DATA = {
                CITY_1: { cost: 1664, currency: 'DOVX', winReward: 0, packRatio: 1 },
                BUNKER: { cost: 44480, currency: 'TU', winReward: 3838, packRatio: 27 }, 
                CAMP: { cost: 112880, currency: 'TU', winReward: 9739, packRatio: 1 }
            };

            const currentZoneData = ZONE_DATA[activeZone];
            const packRatio = currentZoneData.packRatio;

            // COST CALCULATION
            let unitRunCostWax = 0;
            if (currentZoneData.currency === 'TU') {
                unitRunCostWax = currentZoneData.cost * tuPrice;
            } else {
                unitRunCostWax = currentZoneData.cost * marketPrices.DOVX;
            }
            
            // REWARD CALCULATION PER RUN
            const unitWinRewardWax = currentZoneData.winReward * marketPrices.DOVX;

            const BLEND_REQ = 120;
            const F4_REQ = 27; 
            const RUNS_PER_DAY_PER_ACCOUNT = 3;

            const resetSim = () => {
                setInventory({ FUEL: 0, REPAIR: 0, SUPPLY: 0, HEALTH: 0, F4_FUEL: 0, F4_REPAIR: 0, F4_SUPPLY: 0, F4_HEALTH: 0, KEY_CITY: 0, KEY_BEACH: 0, KEY_FOREST: 0 });
                setSimStats({ runs: 0, completed: false });
            };

            const runSimulation = () => {
                let currentInv = { ...inventory };
                let packsOpened = simStats.runs;
                let isComplete = false;
                
                const checkCompletion = (inv) => {
                    const getEquivalent = (type) => inv[type] + (inv[`F4_${type}`] * 27);
                    if (targetType === 'ALL_4') return getEquivalent('FUEL') >= BLEND_REQ && getEquivalent('REPAIR') >= BLEND_REQ && getEquivalent('SUPPLY') >= BLEND_REQ && getEquivalent('HEALTH') >= BLEND_REQ;
                    if (targetType === 'FIRST_ONE') return getEquivalent('FUEL') >= BLEND_REQ || getEquivalent('REPAIR') >= BLEND_REQ || getEquivalent('SUPPLY') >= BLEND_REQ || getEquivalent('HEALTH') >= BLEND_REQ;
                    return false;
                };
                
                const MAX_PACKS = 10000; 
                while (!isComplete && packsOpened < MAX_PACKS) {
                    packsOpened++;
                    const randBuild = Math.random(); 
                    if (activeZone === 'CITY_1') {
                        if (randBuild < 0.25) currentInv.FUEL++; else if (randBuild < 0.50) currentInv.REPAIR++; else if (randBuild < 0.75) currentInv.SUPPLY++; else currentInv.HEALTH++;
                    } else {
                        if (randBuild < 0.2498) currentInv.FUEL++; else if (randBuild < 0.2500) currentInv.F4_FUEL++; else if (randBuild < 0.4998) currentInv.REPAIR++; else if (randBuild < 0.5000) currentInv.F4_REPAIR++; else if (randBuild < 0.7498) currentInv.SUPPLY++; else if (randBuild < 0.7500) currentInv.F4_SUPPLY++; else if (randBuild < 0.9998) currentInv.HEALTH++; else currentInv.F4_HEALTH++; 
                    }
                    const randKey = Math.random();
                    if (randKey < 0.3333) currentInv.KEY_CITY++; else if (randKey < 0.6666) currentInv.KEY_BEACH++; else currentInv.KEY_FOREST++;

                    if (checkCompletion(currentInv)) isComplete = true;
                }
                setInventory(currentInv);
                setSimStats({ runs: packsOpened, completed: isComplete });
            };

            const formatUSD = (waxAmount) => `$${(waxAmount * waxPriceUsd).toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;

            // --- REAL TIME CALCULATIONS ---
            const totalDailyRuns = numAccounts * RUNS_PER_DAY_PER_ACCOUNT;
            const packsPerDay = totalDailyRuns / packRatio;
            const daysNeeded = simStats.runs > 0 ? Math.ceil(simStats.runs / packsPerDay) : 0;
            
            // Revenue Calculation Logic
            const probF4 = activeZone === 'CITY_1' ? 0 : 0.0008; 
            const probF1 = activeZone === 'CITY_1' ? 1 : 0.9992;
            const avgBuildRev = (probF1 * f1Price) + (probF4 * f4Price);
            const averageKeyPrice = (keyPrices.CITY + keyPrices.BEACH + keyPrices.FOREST) / 3;
            
            // Daily Projections
            const dailyCostWax = totalDailyRuns * unitRunCostWax;
            const dailyWinRewardWax = totalDailyRuns * unitWinRewardWax;
            const dailyDropRevenueWax = packsPerDay * (averageKeyPrice + avgBuildRev);
            const dailyRevenueWaxTotal = dailyWinRewardWax + dailyDropRevenueWax;
            const dailyProfitWax = dailyRevenueWaxTotal - dailyCostWax;
            
            // Total Stats
            const totalCostWax = (simStats.runs * packRatio) * unitRunCostWax;
            const totalWinRewardWax = (simStats.runs * packRatio) * unitWinRewardWax;
            
            const keyRevenueTotal = (inventory.KEY_CITY * keyPrices.CITY) + (inventory.KEY_BEACH * keyPrices.BEACH) + (inventory.KEY_FOREST * keyPrices.FOREST);
            
            let buildingRevenueTotal = 0;
            if (sellMode === 'UNIT') {
                const totalF1s = inventory.FUEL + inventory.REPAIR + inventory.SUPPLY + inventory.HEALTH;
                const totalF4s = inventory.F4_FUEL + inventory.F4_REPAIR + inventory.F4_SUPPLY + inventory.F4_HEALTH;
                buildingRevenueTotal = (totalF1s * f1Price) + (totalF4s * f4Price);
            } else {
                const calcF4 = (f1, f4) => f4 + Math.floor(f1 / F4_REQ);
                const totalSellableF4 = calcF4(inventory.FUEL, inventory.F4_FUEL) + calcF4(inventory.REPAIR, inventory.F4_REPAIR) + calcF4(inventory.SUPPLY, inventory.F4_SUPPLY) + calcF4(inventory.HEALTH, inventory.F4_HEALTH);
                buildingRevenueTotal = totalSellableF4 * f4Price;
            }

            const netCostWax = totalCostWax - (keyRevenueTotal + buildingRevenueTotal + totalWinRewardWax); 

            // CYCLE ANALYSIS (For 1 Pack Cycle)
            const cycleCostTU = currentZoneData.cost * packRatio;
            const cycleCostWax = unitRunCostWax * packRatio;
            const cycleRewardDOVX = currentZoneData.winReward * packRatio;
            const cycleRewardWax = unitWinRewardWax * packRatio;
            const cycleNetWax = cycleRewardWax - cycleCostWax;
            const cycleFundedPct = cycleCostWax > 0 ? (cycleRewardWax / cycleCostWax) * 100 : 0;

            const roiMetrics = [
                { label: '24 Heures', multiplier: 1 },
                { label: '30 Jours', multiplier: 30 },
                { label: '1 An (365j)', multiplier: 365 },
            ];
            
            const totalF4Dropped = inventory.F4_FUEL + inventory.F4_REPAIR + inventory.F4_SUPPLY + inventory.F4_HEALTH;
            
            // ACCESS LOGIC
            const droppedKeyMaxOrder = inventory.KEY_CITY > 0 ? 9 : (inventory.KEY_FOREST > 0 ? 8 : (inventory.KEY_BEACH > 0 ? 4 : 0));
            const hasCityAccess = droppedKeyMaxOrder >= 9;

            return (
                <div className="space-y-6 animate-fade-in">
                    <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        {/* CONFIG */}
                        <div className="space-y-6">
                            <Card className="border-t-4 border-t-pink-500">
                                <h3 className="text-lg font-bold text-pink-300 mb-4 flex items-center gap-2"><FlaskConical size={20} /> ParamÃ¨tres Blend</h3>
                                <div className="space-y-4">
                                    <div className="bg-slate-900 p-1 rounded border border-slate-700 flex mb-2">
                                        <button onClick={() => { setActiveZone('CITY_1'); resetSim(); }} className={`flex-1 py-2 text-xs font-bold rounded flex items-center justify-center gap-2 ${activeZone === 'CITY_1' ? 'bg-pink-600 text-white' : 'text-slate-400 hover:bg-slate-800'}`}><Shield size={14}/> CITY 1</button>
                                        <button onClick={() => { setActiveZone('BUNKER'); resetSim(); }} className={`flex-1 py-2 text-xs font-bold rounded flex items-center justify-center gap-2 ${activeZone === 'BUNKER' ? 'bg-yellow-600 text-white' : 'text-slate-400 hover:bg-slate-800'}`}><Compass size={14}/> BUNKER</button>
                                        <button onClick={() => { setActiveZone('CAMP'); resetSim(); }} className={`flex-1 py-2 text-xs font-bold rounded flex items-center justify-center gap-2 ${activeZone === 'CAMP' ? 'bg-green-600 text-white' : 'text-slate-400 hover:bg-slate-800'}`}>ðŸŒ² CAMP</button>
                                    </div>

                                    {/* CYCLE ANALYSIS FOR BUNKER */}
                                    {activeZone === 'BUNKER' && (
                                        <div className="bg-gradient-to-r from-blue-900/50 to-slate-900 p-3 rounded border border-blue-500/50">
                                            <div className="flex items-center gap-2 mb-2 text-blue-300 font-bold text-xs uppercase"><RefreshCw size={14}/> Cycle Ã‰conomique (27 Runs)</div>
                                            <div className="grid grid-cols-2 gap-2 text-sm mb-2">
                                                <div>
                                                    <div className="text-[10px] text-slate-400">DÃ©penses TU (Total)</div>
                                                    <div className="font-mono text-red-300">-{cycleCostTU.toLocaleString()} TU</div>
                                                    <div className="font-bold text-red-400">{cycleCostWax.toFixed(0)} W</div>
                                                </div>
                                                <div className="text-right">
                                                    <div
