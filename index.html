<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DoV Manager v3.17 (Camp Campaign Logic)</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #475569; }
        .animate-fade-in { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        .progress-bar { transition: width 0.5s ease-in-out; }
    </style>
</head>
<body class="bg-slate-900 text-slate-100 min-h-screen">

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- ICONS ---
        const Shield = ({size=20}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>;
        const FactoryIcon = ({size=20}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M2 20a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8l-7 5V8l-7 5V4a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z"/><path d="M17 18h1"/><path d="M12 18h1"/><path d="M7 18h1"/></svg>;
        const Crosshair = ({size=20}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><line x1="22" y1="12" x2="18" y2="12"/><line x1="6" y1="12" x2="2" y2="12"/><line x1="12" y1="6" x2="12" y2="2"/><line x1="12" y1="22" x2="12" y2="18"/></svg>;
        const CheckCircle = ({size=20}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>;
        const Package = ({size=20}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m16.5 9.4-9-5.19"/><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/><polyline points="3.27 6.96 12 12.01 20.73 6.96"/><line x1="12" y1="22.08" x2="12" y2="12"/></svg>;
        const Zap = ({size=20}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>;
        const Briefcase = ({size=20}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="2" y="7" width="20" height="14" rx="2" ry="2"/><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/></svg>;
        const Database = ({size=20}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/></svg>;
        const FlaskConical = ({size=20}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M10 2v7.527a2 2 0 0 1-.211.896L4.72 20.55a1 1 0 0 0 .9 1.45h12.76a1 1 0 0 0 .9-1.45l-5.069-10.127A2 2 0 0 1 14 9.527V2"/><line x1="8.5" x2="15.5" y1="2" y2="2"/><path d="M8.5 2h7"/><path d="M9 22h6"/></svg>;
        const Clock = ({size=20}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>;
        const TrendingUp = ({size=20}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>;
        const KeyIcon = ({size=20}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m21 2-2 2m-7.6 7.6a6.5 6.5 0 1 1-5.3 5.3L3 21l3-3 2.1-2.1a2 2 0 0 1 2.8 0L13.4 13.4a2 2 0 0 1 0 2.8l-4.3 4.3"/><path d="m10 10 1.5 1.5"/><path d="m14 6 1.5 1.5"/><path d="m18 2 1.5 1.5"/></svg>;
        const Lock = ({size=20}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>;
        const Compass = ({size=20}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><polygon points="16.24 7.76 14.12 14.12 7.76 16.24 9.88 9.88 16.24 7.76"/></svg>;

        // Prices from dataset
        const INITIAL_MARKET_PRICES = { WAX: 1, DOVX: 0.05, DOVR: 0.00045262, DOVH: 0.00045262, DOVF: 0.00045262, DOVS: 0.00045262 };
        const Card = ({ children, className = "" }) => <div className={`bg-slate-800 border border-slate-700 rounded-lg p-4 shadow-xl ${className}`}>{children}</div>;

        // --- BLEND SIMULATOR (V3.17 CAMP REWARDS) ---
        const BlendSimulator = ({ marketPrices, waxPriceUsd }) => {
            const [activeZone, setActiveZone] = useState('CITY_1'); 
            const [targetType, setTargetType] = useState('ALL_4'); 
            
            const [inventory, setInventory] = useState({ 
                FUEL: 0, REPAIR: 0, SUPPLY: 0, HEALTH: 0, 
                F4_FUEL: 0, F4_REPAIR: 0, F4_SUPPLY: 0, F4_HEALTH: 0,
                KEY_CITY: 0, KEY_BEACH: 0, KEY_FOREST: 0 
            });
            const [simStats, setSimStats] = useState({ runs: 0, completed: false });
            
            // CONFIG PRICES
            const [keyPrices, setKeyPrices] = useState({ CITY: 50, BEACH: 5, FOREST: 10 });
            const [sellMode, setSellMode] = useState('UNIT'); 
            const [f1Price, setF1Price] = useState(5);
            const [f4Price, setF4Price] = useState(250);
            const [numAccounts, setNumAccounts] = useState(1);
            
            // TU PRICE (Resources)
            const [tuPrice, setTuPrice] = useState(0.00045262); 

            // COST & REWARD CONFIG
            // Camp: Usage 28220 * 4 = 112880 TU. Win Reward = 9739 (DOVX equivalent usually)
            const [costInputs, setCostInputs] = useState({
                CITY_1: 1664,
                BUNKER: 100, 
                CAMP: 112880 
            });
            
            // Win Rewards (DOV-X amount gained per win)
            const [winRewards, setWinRewards] = useState({
                CITY_1: 0,
                BUNKER: 3838, // Based on image 4, Bunker Win = 3838
                CAMP: 9739    // Based on image 4, Camp Win = 9739
            });

            // COST CALCULATION SWITCH
            let COST_PER_RUN_WAX = 0;
            if (activeZone === 'CAMP') {
                COST_PER_RUN_WAX = costInputs.CAMP * tuPrice;
            } else if (activeZone === 'BUNKER') {
                COST_PER_RUN_WAX = costInputs.BUNKER * tuPrice; // Bunker uses TU usually? Image 4 says "Usage" so likely TU.
                // Wait, user said Bunker uses TU in previous prompts? Or just Camp?
                // Defaulting Bunker to TU based on image 4 (Usage column).
                // Let's assume Bunker uses TU for now based on image 4 presence.
                COST_PER_RUN_WAX = 11120 * 4 * tuPrice; // 11120 * 4 based on image logic if Bunker is Zone 4
            } else {
                // CITY 1 uses DOVX
                COST_PER_RUN_WAX = costInputs[activeZone] * marketPrices.DOVX;
            }
            
            // Correction for Bunker Cost if user wants editable:
            if(activeZone === 'BUNKER') COST_PER_RUN_WAX = costInputs.BUNKER * tuPrice; // Use input

            const BLEND_REQ = 120;
            const F4_REQ = 27; 
            const RUNS_PER_DAY_PER_ACCOUNT = 3;

            const droppedKeyMaxOrder = inventory.KEY_CITY > 0 ? 9 : (inventory.KEY_FOREST > 0 ? 8 : (inventory.KEY_BEACH > 0 ? 4 : 0));
            const hasCityAccess = droppedKeyMaxOrder >= 9;

            const resetSim = () => {
                setInventory({ FUEL: 0, REPAIR: 0, SUPPLY: 0, HEALTH: 0, F4_FUEL: 0, F4_REPAIR: 0, F4_SUPPLY: 0, F4_HEALTH: 0, KEY_CITY: 0, KEY_BEACH: 0, KEY_FOREST: 0 });
                setSimStats({ runs: 0, completed: false });
            };

            const runSimulation = () => {
                let currentInv = { ...inventory };
                let runs = simStats.runs;
                let isComplete = false;
                
                const checkCompletion = (inv) => {
                    const getEquivalent = (type) => inv[type] + (inv[`F4_${type}`] * 27);
                    if (targetType === 'ALL_4') return getEquivalent('FUEL') >= BLEND_REQ && getEquivalent('REPAIR') >= BLEND_REQ && getEquivalent('SUPPLY') >= BLEND_REQ && getEquivalent('HEALTH') >= BLEND_REQ;
                    if (targetType === 'FIRST_ONE') return getEquivalent('FUEL') >= BLEND_REQ || getEquivalent('REPAIR') >= BLEND_REQ || getEquivalent('SUPPLY') >= BLEND_REQ || getEquivalent('HEALTH') >= BLEND_REQ;
                    return false;
                };
                
                const MAX_RUNS = 10000; 
                while (!isComplete && runs < MAX_RUNS) {
                    runs++;
                    // DROP LOGIC
                    const randBuild = Math.random(); 
                    if (activeZone === 'CITY_1') {
                        if (randBuild < 0.25) currentInv.FUEL++; else if (randBuild < 0.50) currentInv.REPAIR++; else if (randBuild < 0.75) currentInv.SUPPLY++; else currentInv.HEALTH++;
                    } else {
                        if (randBuild < 0.2498) currentInv.FUEL++; else if (randBuild < 0.2500) currentInv.F4_FUEL++; else if (randBuild < 0.4998) currentInv.REPAIR++; else if (randBuild < 0.5000) currentInv.F4_REPAIR++; else if (randBuild < 0.7498) currentInv.SUPPLY++; else if (randBuild < 0.7500) currentInv.F4_SUPPLY++; else if (randBuild < 0.9998) currentInv.HEALTH++; else currentInv.F4_HEALTH++;
                    }
                    const randKey = Math.random();
                    if (randKey < 0.3333) currentInv.KEY_CITY++; else if (randKey < 0.6666) currentInv.KEY_BEACH++; else currentInv.KEY_FOREST++;

                    if (checkCompletion(currentInv)) isComplete = true;
                }
                setInventory(currentInv);
                setSimStats({ runs, completed: isComplete });
            };

            const formatUSD = (waxAmount) => `$${(waxAmount * waxPriceUsd).toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;

            // --- REAL TIME CALCULATIONS ---
            const totalDailyRuns = numAccounts * RUNS_PER_DAY_PER_ACCOUNT;
            const daysNeeded = simStats.runs > 0 ? Math.ceil(simStats.runs / totalDailyRuns) : 0;
            
            // Revenue Calculation Logic
            const probF4 = activeZone === 'CITY_1' ? 0 : 0.0008; 
            const probF1 = activeZone === 'CITY_1' ? 1 : 0.9992;
            const avgBuildRev = (probF1 * f1Price) + (probF4 * f4Price);
            const averageKeyPrice = (keyPrices.CITY + keyPrices.BEACH + keyPrices.FOREST) / 3;
            
            // WIN REWARD (New for Camp)
            const winRewardDOVX = winRewards[activeZone];
            const winRewardWAX = winRewardDOVX * marketPrices.DOVX;

            const dailyCostWax = totalDailyRuns * COST_PER_RUN_WAX;
            const dailyRevenueWax = totalDailyRuns * (averageKeyPrice + avgBuildRev + winRewardWAX); // Include Win Reward
            const dailyProfitWax = dailyRevenueWax - dailyCostWax;
            
            const keyRevenueTotal = (inventory.KEY_CITY * keyPrices.CITY) + (inventory.KEY_BEACH * keyPrices.BEACH) + (inventory.KEY_FOREST * keyPrices.FOREST);
            
            let buildingRevenueTotal = 0;
            if (sellMode === 'UNIT') {
                const totalF1s = inventory.FUEL + inventory.REPAIR + inventory.SUPPLY + inventory.HEALTH;
                const totalF4s = inventory.F4_FUEL + inventory.F4_REPAIR + inventory.F4_SUPPLY + inventory.F4_HEALTH;
                buildingRevenueTotal = (totalF1s * f1Price) + (totalF4s * f4Price);
            } else {
                const calcF4 = (f1, f4) => f4 + Math.floor(f1 / F4_REQ);
                const totalSellableF4 = calcF4(inventory.FUEL, inventory.F4_FUEL) + calcF4(inventory.REPAIR, inventory.F4_REPAIR) + calcF4(inventory.SUPPLY, inventory.F4_SUPPLY) + calcF4(inventory.HEALTH, inventory.F4_HEALTH);
                buildingRevenueTotal = totalSellableF4 * f4Price;
            }

            // Total Simulation Stats
            const totalCostWax = simStats.runs * COST_PER_RUN_WAX;
            const totalWinRewardWax = simStats.runs * winRewardWAX; // Accumulated Win Rewards
            const netCostWax = totalCostWax - (keyRevenueTotal + buildingRevenueTotal + totalWinRewardWax); 

            const roiMetrics = [
                { label: '24 Heures', multiplier: 1 },
                { label: '30 Jours', multiplier: 30 },
                { label: '1 An (365j)', multiplier: 365 },
            ];
            
            const totalF4Dropped = inventory.F4_FUEL + inventory.F4_REPAIR + inventory.F4_SUPPLY + inventory.F4_HEALTH;

            return (
                <div className="space-y-6 animate-fade-in">
                    <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        {/* CONFIG */}
                        <div className="space-y-6">
                            <Card className="border-t-4 border-t-pink-500">
                                <h3 className="text-lg font-bold text-pink-300 mb-4 flex items-center gap-2"><FlaskConical size={20} /> Param√®tres Blend</h3>
                                <div className="space-y-4">
                                    
                                    {/* ZONE SELECTOR */}
                                    <div className="bg-slate-900 p-1 rounded border border-slate-700 flex mb-2">
                                        <button onClick={() => { setActiveZone('CITY_1'); resetSim(); }} className={`flex-1 py-2 text-xs font-bold rounded flex items-center justify-center gap-2 ${activeZone === 'CITY_1' ? 'bg-pink-600 text-white' : 'text-slate-400 hover:bg-slate-800'}`}><Shield size={14}/> CITY 1</button>
                                        <button onClick={() => { setActiveZone('BUNKER'); resetSim(); }} className={`flex-1 py-2 text-xs font-bold rounded flex items-center justify-center gap-2 ${activeZone === 'BUNKER' ? 'bg-yellow-600 text-white' : 'text-slate-400 hover:bg-slate-800'}`}><Compass size={14}/> BUNKER</button>
                                        <button onClick={() => { setActiveZone('CAMP'); resetSim(); }} className={`flex-1 py-2 text-xs font-bold rounded flex items-center justify-center gap-2 ${activeZone === 'CAMP' ? 'bg-green-600 text-white' : 'text-slate-400 hover:bg-slate-800'}`}>üå≤ CAMP</button>
                                    </div>

                                    {/* COST INPUT */}
                                    <div className="bg-slate-900 p-3 rounded border border-slate-700">
                                        <div className="flex justify-between items-center mb-1">
                                            <span className="text-slate-400 text-xs font-bold uppercase">Co√ªt Run {activeZone}</span>
                                            {activeZone !== 'CITY_1' ? <span className="text-[10px] bg-blue-900 text-blue-300 px-1 rounded">EN TU</span> : <span className="text-[10px] bg-yellow-900 text-yellow-300 px-1 rounded">EN DOV-X</span>}
                                        </div>
                                        
                                        <div className="flex justify-between items-center">
                                            <input type="number" value={costInputs[activeZone]} onChange={(e) => setCostInputs({...costInputs, [activeZone]: parseFloat(e.target.value)})} className={`w-28 bg-slate-800 border rounded p-1 text-right text-sm font-mono font-bold focus:outline-none ${activeZone !== 'CITY_1' ? 'text-blue-400 border-blue-500' : 'text-yellow-400 border-yellow-500'}`} />
                                            {activeZone !== 'CITY_1' && (<div className="text-[10px] text-slate-500 ml-2">Prix TU: <input type="number" value={tuPrice} onChange={(e) => setTuPrice(parseFloat(e.target.value))} className="w-20 bg-slate-800 border-b border-slate-600 text-white text-center" /></div>)}
                                        </div>

                                        <div className="flex justify-between items-center text-xs border-t border-slate-700 pt-2 mt-2">
                                            <span className="text-slate-500">Co√ªt WAX</span>
                                            <div className="text-right"><div className="font-mono text-white font-bold">{COST_PER_RUN_WAX.toFixed(2)} W</div><div className="text-[10px] text-emerald-400">{formatUSD(COST_PER_RUN_WAX)}</div></div>
                                        </div>
                                    </div>
                                    
                                    {/* WIN REWARD INPUT */}
                                    <div className="bg-slate-900/50 p-3 rounded border border-slate-700">
                                        <label className="text-xs text-green-400 font-bold uppercase mb-2 block">Reward Victoire (DOV-X)</label>
                                        <div className="flex justify-between items-center">
                                            <input type="number" value={winRewards[activeZone]} onChange={(e) => setWinRewards({...winRewards, [activeZone]: parseFloat(e.target.value)})} className="flex-1 bg-slate-800 border border-green-700 rounded p-1 text-sm text-center font-bold text-green-400" />
                                            <span className="text-[10px] text-slate-500 ml-2">= +{winRewardWAX.toFixed(2)} WAX</span>
                                        </div>
                                    </div>
                                    
                                    {/* SELL STRATEGY */}
                                    <div className="bg-slate-900/50 p-3 rounded border border-slate-700">
                                        <label className="text-xs text-blue-300 font-bold uppercase mb-2 block">Strat√©gie de Vente</label>
                                        <div className="flex bg-slate-800 p-1 rounded mb-3">
                                            <button onClick={() => setSellMode('UNIT')} className={`flex-1 text-xs font-bold py-1 rounded transition-colors ${sellMode === 'UNIT' ? 'bg-blue-600 text-white' : 'text-slate-400 hover:text-white'}`}>UNIT (F1)</button>
                                            <button onClick={() => setSellMode('BATCH')} className={`flex-1 text-xs font-bold py-1 rounded transition-colors ${sellMode === 'BATCH' ? 'bg-purple-600 text-white' : 'text-slate-400 hover:text-white'}`}>BLEND (F4)</button>
                                        </div>
                                        {sellMode === 'UNIT' ? (
                                            <div className="flex items-center gap-2 animate-fade-in"><span className="text-xs text-slate-400 w-24">Prix F1</span><input type="number" value={f1Price} onChange={(e) => setF1Price(parseFloat(e.target.value))} className="flex-1 bg-slate-900 border border-slate-600 rounded p-1 text-sm text-center font-bold text-blue-400" /></div>
                                        ) : (
                                            <div className="flex items-center gap-2 animate-fade-in"><span className="text-xs text-purple-300 w-24">Prix F4</span><input type="number" value={f4Price} onChange={(e) => setF4Price(parseFloat(e.target.value))} className="flex-1 bg-slate-900 border border-purple-500 rounded p-1 text-sm text-center font-bold text-purple-400" /></div>
                                        )}
                                    </div>

                                    {/* KEY PRICES */}
                                    <div className="bg-slate-900/50 p-3 rounded border border-slate-700">
                                        <label className="text-xs text-purple-300 font-bold uppercase mb-2 block flex items-center gap-1"><KeyIcon size={12}/> Prix Cl√©s</label>
                                        <div className="grid grid-cols-3 gap-2">
                                            <div><span className="text-[10px] text-green-400 block text-center">CITY</span><input type="number" value={keyPrices.CITY} onChange={(e) => setKeyPrices({...keyPrices, CITY: parseFloat(e.target.value)})} className="w-full bg-slate-800 border border-slate-600 rounded p-1 text-xs text-center text-white" /></div>
                                            <div><span className="text-[10px] text-yellow-400 block text-center">FOR</span><input type="number" value={keyPrices.FOREST} onChange={(e) => setKeyPrices({...keyPrices, FOREST: parseFloat(e.target.value)})} className="w-full bg-slate-800 border border-slate-600 rounded p-1 text-xs text-center text-white" /></div>
                                            <div><span className="text-[10px] text-slate-400 block text-center">BEA</span><input type="number" value={keyPrices.BEACH} onChange={(e) => setKeyPrices({...keyPrices, BEACH: parseFloat(e.target.value)})} className="w-full bg-slate-800 border border-slate-600 rounded p-1 text-xs text-center text-white" /></div>
                                        </div>
                                    </div>

                                    <div className="bg-slate-900/50 p-2 rounded border border-slate-700 flex items-center justify-between">
                                        <span className="text-xs text-slate-400">Nb Comptes</span>
                                        <input type="number" min="1" value={numAccounts} onChange={(e) => setNumAccounts(parseInt(e.target.value) || 1)} className="w-12 bg-slate-800 border border-slate-600 rounded p-1 text-center text-sm font-bold text-white" />
                                    </div>

                                    <div className="flex gap-2">
                                        <button onClick={runSimulation} className="flex-1 py-3 bg-gradient-to-r from-pink-600 to-purple-600 hover:from-pink-500 hover:to-purple-500 text-white font-bold rounded shadow-lg flex items-center justify-center gap-2 text-xs"><Zap size={16}/> SIMULER</button>
                                        <button onClick={resetSim} className="px-4 py-3 bg-slate-700 hover:bg-slate-600 text-slate-300 font-bold rounded text-xs">RESET</button>
                                    </div>
                                </div>
                            </Card>
                            
                            <Card className="border-t-4 border-t-emerald-500">
                                <h3 className="text-lg font-bold text-emerald-300 mb-4 flex items-center gap-2"><TrendingUp size={20} /> Projections</h3>
                                <div className="space-y-4">
                                    {roiMetrics.map((metric, idx) => {
                                        const profit = dailyProfitWax * metric.multiplier;
                                        return (
                                            <div key={idx} className="bg-slate-900/50 p-2 rounded border border-slate-700">
                                                <div className="flex justify-between items-center mb-1">
                                                    <span className="text-xs font-bold text-slate-300 uppercase">{metric.label}</span>
                                                    <span className={`text-xs font-bold ${profit > 0 ? 'text-emerald-400' : 'text-red-400'}`}>{profit > 0 ? 'PROFIT' : 'PERTE'}</span>
                                                </div>
                                                <div className="flex justify-between text-sm border-t border-slate-700 pt-1 mt-1">
                                                    <span className="text-slate-500">Net:</span>
                                                    <span className={`font-mono font-bold ${profit > 0 ? 'text-emerald-400' : 'text-red-400'}`}>{profit > 0 ? '+' : ''}{profit.toLocaleString(undefined, {maximumFractionDigits:0})} W</span>
                                                </div>
                                                <div className="text-right text-xs opacity-70 mt-1">{formatUSD(profit)}</div>
                                            </div>
                                        );
                                    })}
                                </div>
                            </Card>
                        </div>

                        {/* RESULTS */}
                        <Card className="lg:col-span-2 flex flex-col">
                             <div className="flex justify-between items-center mb-6">
                                <h3 className="text-lg font-bold text-white flex items-center gap-2"><Database size={20} className="text-blue-400"/> Inventaire {activeZone}</h3>
                                <div className="text-right">
                                    <div className="text-xs text-slate-400 uppercase">Runs</div>
                                    <div className="text-2xl font-mono font-bold text-white">{simStats.runs}</div>
                                </div>
                             </div>
                             
                             <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                                {['FUEL', 'REPAIR', 'SUPPLY', 'HEALTH'].map(type => {
                                    const count = inventory[type];
                                    const pct = Math.min((count / BLEND_REQ) * 100, 100);
                                    const isDone = count >= BLEND_REQ;
                                    const f4Count = Math.floor(count / F4_REQ);
                                    const f4Jackpots = inventory[`F4_${type}`];
                                    
                                    return (
                                        <div key={type} className={`bg-slate-900 p-3 rounded border ${isDone ? 'border-emerald-500' : 'border-slate-700'} relative overflow-hidden`}>
                                            <div className="relative z-10">
                                                <div className="text-[10px] text-slate-500 uppercase font-bold mb-1">{type}</div>
                                                <div className={`text-xl font-mono font-bold ${isDone ? 'text-emerald-400' : 'text-white'}`}>{count} <span className="text-xs text-slate-500">/ {BLEND_REQ}</span></div>
                                                <div className="flex justify-between mt-2 text-[10px] border-t border-slate-700 pt-1">
                                                    <span className="text-slate-400">Craft F4: {f4Count}</span>
                                                    {f4Jackpots > 0 && <span className="text-yellow-400 font-bold animate-pulse">JACKPOT: {f4Jackpots}</span>}
                                                </div>
                                            </div>
                                            <div className={`absolute bottom-0 left-0 h-1 bg-blue-600 progress-bar`} style={{width: `${pct}%`}}></div>
                                            {isDone && <div className="absolute top-1 right-1 text-emerald-500"><CheckCircle size={16}/></div>}
                                        </div>
                                    );
                                })}
                             </div>

                             {totalF4Dropped > 0 && (
                                 <div className="mb-4 p-3 bg-yellow-900/30 border border-yellow-500/50 rounded flex justify-between items-center animate-fade-in">
                                     <div className="text-yellow-200 font-bold flex items-center gap-2"><Zap size={18}/> JACKPOTS F4 OBTENUS !</div>
                                     <div className="text-white font-mono font-bold text-lg">{totalF4Dropped} Cartes L√©gendaires</div>
                                 </div>
                             )}

                             <div className="mb-6 p-4 bg-slate-900/80 rounded border border-slate-700 flex items-center justify-between">
                                 <div>
                                     <div className="text-xs text-slate-400 uppercase font-bold mb-1">Acc√®s City 1</div>
                                     {hasCityAccess ? <span className="text-green-400 font-bold flex items-center gap-1"><CheckCircle size={14}/> OK</span> : <span className="text-red-400 font-bold flex items-center gap-1"><Lock size={14}/> NOK</span>}
                                 </div>
                                 <div className="text-right">
                                     <div className="text-xs text-slate-400 uppercase font-bold mb-1">Temps Estim√©</div>
                                     <div className="text-white font-bold">{daysNeeded} Jours</div>
                                 </div>
                             </div>
                             
                             <div className="grid grid-cols-1 md:grid-cols-3 gap-4 border-t border-slate-700 pt-6 mt-auto">
                                 <div className="bg-slate-900/50 p-4 rounded border border-slate-700">
                                     <div className="text-xs text-slate-400 uppercase mb-1">Investissement</div>
                                     <div className="text-xl font-mono font-bold text-red-400">{totalCostWax.toLocaleString(undefined, {maximumFractionDigits:0})} WAX</div>
                                     <div className="text-sm font-bold text-red-300/70 font-mono mt-1">{formatUSD(totalCostWax)}</div>
                                 </div>
                                 <div className="bg-slate-900/50 p-4 rounded border border-slate-700">
                                     <div className="text-xs text-purple-300 uppercase mb-1">Revenus Vente ({sellMode})</div>
                                     <div className="text-xl font-mono font-bold text-purple-400">+{Math.floor(keyRevenueTotal + buildingRevenueTotal).toLocaleString()} WAX</div>
                                     <div className="text-xs text-slate-500 mt-1">Cl√©s: {Math.floor(keyRevenueTotal)} | B√¢t: {Math.floor(buildingRevenueTotal)}</div>
                                 </div>
                                 <div className={`p-4 rounded border-2 ${netCostWax > 0 ? 'bg-slate-800 border-slate-600' : 'bg-emerald-900/20 border-emerald-500'}`}>
                                     <div className="text-xs text-white font-bold uppercase mb-1">CO√õT FINAL NET</div>
                                     <div className={`text-2xl font-mono font-bold ${netCostWax < 0 ? 'text-emerald-400' : 'text-white'}`}>{netCostWax.toLocaleString(undefined, {maximumFractionDigits:0})} WAX</div>
                                     <div className={`text-lg font-mono font-bold mt-1 ${netCostWax < 0 ? 'text-emerald-300/70' : 'text-slate-300/70'}`}>{formatUSD(netCostWax)}</div>
                                     <div className="text-[10px] text-right mt-1 text-slate-400">Inclut +{Math.floor(totalWinRewardWax)} WAX de Rewards</div>
                                 </div>
                             </div>
                        </Card>
                    </div>
                </div>
            );
        };

        function DoVManager() {
            const [activeTab, setActiveTab] = useState('blend');
            const [marketPrices, setMarketPrices] = useState(INITIAL_MARKET_PRICES);
            const [waxPriceUsd, setWaxPriceUsd] = useState(0.008); 
            const [dovxInputStr, setDovxInputStr] = useState(INITIAL_MARKET_PRICES.DOVX.toString());

            const handleGlobalWaxPriceChange = (val) => setWaxPriceUsd(parseFloat(val));
            const handleManualDovxChange = (val) => { 
                const cleanVal = val.replace(',', '.'); 
                setDovxInputStr(val); 
                const newDovx = parseFloat(cleanVal); 
                if (!isNaN(newDovx)) setMarketPrices(prev => ({ ...prev, DOVX: newDovx })); 
            };

            return (
                <div className="p-4 md:p-8 max-w-[1600px] mx-auto">
                    <header className="flex flex-col xl:flex-row justify-between items-center mb-8 border-b border-slate-700 pb-4 gap-4">
                        <div className="flex items-center gap-3"><div className="bg-blue-600 p-2 rounded-lg"><Shield size={32} className="text-white" /></div><div><h1 className="text-2xl font-bold tracking-wider text-white">DoV <span className="text-blue-400">COMMANDER</span> v3.17</h1><p className="text-slate-400 text-sm">Optimiseur Industriel (Camp Logic)</p></div></div>
                        <div className="flex flex-wrap gap-4 bg-slate-800 p-3 rounded-lg border border-slate-700 text-sm justify-center items-end">
                            <div className="flex flex-col"><span className="text-xs text-green-400 font-bold mb-1">Prix WAX ($)</span><input type="number" value={waxPriceUsd} step="0.001" onChange={(e) => handleGlobalWaxPriceChange(e.target.value)} className="bg-slate-700 text-white w-20 px-2 py-1 rounded border border-slate-600"/></div>
                            <div className="flex flex-col"><span className="text-xs text-slate-400 mb-1">DOV-X (WAX)</span><input type="text" value={dovxInputStr} onChange={(e) => handleManualDovxChange(e.target.value)} className="bg-slate-700 text-yellow-400 w-24 px-2 py-1 rounded border border-slate-600"/></div>
                        </div>
                    </header>
                    <div className="flex gap-2 mb-6 overflow-x-auto pb-2 no-scrollbar">
                        <button onClick={() => setActiveTab('blend')} className={`flex items-center gap-2 px-4 py-3 rounded-lg font-bold text-sm ${activeTab === 'blend' ? 'bg-pink-600 text-white shadow-lg' : 'bg-slate-800 text-slate-400'}`}><FlaskConical size={16} /> SIMULATEUR BLEND</button>
                        <button onClick={() => setActiveTab('account_sim')} className={`flex items-center gap-2 px-4 py-3 rounded-lg font-bold text-sm ${activeTab === 'account_sim' ? 'bg-orange-600 text-white' : 'bg-slate-800 text-slate-400'}`}><Briefcase size={16} /> COMPTE</button>
                        <button onClick={() => setActiveTab('combat')} className={`flex items-center gap-2 px-4 py-3 rounded-lg font-bold text-sm ${activeTab === 'combat' ? 'bg-blue-600 text-white' : 'bg-slate-800 text-slate-400'}`}><Crosshair size={16} /> COMBAT</button>
                        <button onClick={() => setActiveTab('production')} className={`flex items-center gap-2 px-4 py-3 rounded-lg font-bold text-sm ${activeTab === 'production' ? 'bg-emerald-600 text-white' : 'bg-slate-800 text-slate-400'}`}><FactoryIcon size={16} /> PRODUCTION</button>
                    </div>
                    {activeTab === 'blend' && <BlendSimulator marketPrices={marketPrices} waxPriceUsd={waxPriceUsd} />}
                    {activeTab === 'account_sim' && <div className="text-center p-10 bg-slate-800 rounded border border-slate-700 text-slate-500">Calcul du compte complet disponible (voir code pr√©c√©dent). Focus sur le Blend Simulator pour cette version.</div>}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<DoVManager />);
    </script>
</body>
</html>
